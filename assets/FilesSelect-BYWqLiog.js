import{r as P,C as ne,R as le,a as re,b as W,D as q,B as A,c as ie,L as se,A as ae,j as S,d as ce}from"./index-BFMmcQtt.js";import{S as G}from"./index-DbZkjGOZ.js";var de=function(o,e){var l={};for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&e.indexOf(t)<0&&(l[t]=o[t]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,t=Object.getOwnPropertySymbols(o);n<t.length;n++)e.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(o,t[n])&&(l[t[n]]=o[t[n]]);return l};const J=o=>{const{getPopupContainer:e,getPrefixCls:l,direction:t}=P.useContext(ne),{prefixCls:n,type:a="default",danger:c,disabled:F,loading:I,onClick:D,htmlType:i,children:T,className:_,menu:U,arrow:f,autoFocus:z,overlay:R,trigger:N,align:u,open:B,onOpenChange:p,placement:L,getPopupContainer:m,href:v,icon:$=P.createElement(le,null),title:y,buttonsRender:O=oe=>oe,mouseEnterDelay:H,mouseLeaveDelay:h,overlayClassName:g,overlayStyle:C,destroyOnHidden:x,destroyPopupOnHide:k,dropdownRender:w,popupRender:E}=o,j=de(o,["prefixCls","type","danger","disabled","loading","onClick","htmlType","children","className","menu","arrow","autoFocus","overlay","trigger","align","open","onOpenChange","placement","getPopupContainer","href","icon","title","buttonsRender","mouseEnterDelay","mouseLeaveDelay","overlayClassName","overlayStyle","destroyOnHidden","destroyPopupOnHide","dropdownRender","popupRender"]),d=l("dropdown",n),r=`${d}-button`,s={menu:U,arrow:f,autoFocus:z,align:u,disabled:F,trigger:F?[]:N,onOpenChange:p,getPopupContainer:m||e,mouseEnterDelay:H,mouseLeaveDelay:h,overlayClassName:g,overlayStyle:C,destroyOnHidden:x,popupRender:E||w},{compactSize:V,compactItemClassnames:X}=re(d,t),Y=W(r,X,_);"destroyPopupOnHide"in o&&(s.destroyPopupOnHide=k),"overlay"in o&&(s.overlay=R),"open"in o&&(s.open=B),"placement"in o?s.placement=L:s.placement=t==="rtl"?"bottomLeft":"bottomRight";const Z=P.createElement(A,{type:a,danger:c,disabled:F,loading:I,onClick:D,htmlType:i,href:v,title:y},T),K=P.createElement(A,{type:a,danger:c,icon:$}),[ee,te]=O([Z,K]);return P.createElement(G.Compact,Object.assign({className:Y,size:V,block:!0},j),ee,P.createElement(q,Object.assign({},s),te))};J.__ANT_BUTTON=!0;const Q=q;Q.Button=J;function ye(o){const e=ie.c(36),{targetType:l,onSelect:t,isUpload:n,isIgnoreFolder:a,locale:c,className:F,children:I}=o,D=l===void 0?"tree":l,i=n===void 0?!1:n,T=a===void 0?!1:a,_=F===void 0?"":F,U=P.useContext(se),f=c||U||"zh",z=P.useRef(null),{message:R}=ae.useApp(),N=f==="zh"?i?"上传文件":"选择文件":i?"Upload File":"Select File";let u;e[0]!==N?(u={label:N,key:"upload-file"},e[0]=N,e[1]=u):u=e[1];const B=f==="zh"?i?"上传文件夹（含根目录）":"选择文件夹（含根目录）":i?"Upload Folder (Include Root)":"Select Folder (Include Root)";let p;e[2]!==B?(p={label:B,key:"upload-folder-include-root"},e[2]=B,e[3]=p):p=e[3];const L=f==="zh"?i?"上传文件夹（不含根目录）":"选择文件夹（不含根目录）":i?"Upload Folder (Exclude Root)":"Select Folder (Exclude Root)";let m;e[4]!==L?(m={label:L,key:"upload-folder-exclude-root"},e[4]=L,e[5]=m):m=e[5];let v;e[6]!==m||e[7]!==u||e[8]!==p?(v=[u,p,m],e[6]=m,e[7]=u,e[8]=p,e[9]=v):v=e[9];const $=v;let y;if(e[10]!==T||e[11]!==R||e[12]!==t||e[13]!==D){y=d=>{const r=d.key;r==="upload-folder-include-root"?j("upload-folder-include-root"):r==="upload-folder-exclude-root"?j("upload-folder-exclude-root"):z.current&&z.current.click()};async function j(d){if(!window.showDirectoryPicker){R.warning("当前浏览器不支持");return}let r;try{if(r=await window.showDirectoryPicker({mode:"read",id:d}),!r)return;let b;if(d==="upload-folder-include-root"?b=[{type:"folder",name:r.name,filePath:`${r.name}`,folderPath:"/",children:await M(r,`/${r.name}`)}]:b=await M(r,"/"),D==="tree")t(b);else{const s=ue(b,T);t(s)}}catch(b){const s=b;s instanceof Error&&s.message.includes("aborted")?R.warning("请选择文件夹"):console.log(s)}}e[10]=T,e[11]=R,e[12]=t,e[13]=D,e[14]=y}else y=e[14];let O;e[15]!==t?(O=j=>{const d=j.target.files;if(d){const r=Array.from(d).map(fe);r.length>0&&t(r)}},e[15]=t,e[16]=O):O=e[16];const H=O;let h;e[17]!==_?(h=W("files-select inline-flex",_),e[17]=_,e[18]=h):h=e[18];let g;e[19]!==$||e[20]!==y?(g={items:$,onClick:y},e[19]=$,e[20]=y,e[21]=g):g=e[21];let C;e[22]!==I||e[23]!==f||e[24]!==i?(C=I||S.jsx(A,{children:S.jsxs(G,{children:[f==="zh"?i?"上传文件/文件夹":"选择文件/文件夹":i?"Upload File/Folder":"Select File/Folder",S.jsx(ce,{})]})}),e[22]=I,e[23]=f,e[24]=i,e[25]=C):C=e[25];let x;e[26]!==g||e[27]!==C?(x=S.jsx(Q,{menu:g,children:C}),e[26]=g,e[27]=C,e[28]=x):x=e[28];let k;e[29]===Symbol.for("react.memo_cache_sentinel")?(k={display:"none"},e[29]=k):k=e[29];let w;e[30]!==H?(w=S.jsx("input",{ref:z,type:"file",multiple:!0,style:k,onChange:H}),e[30]=H,e[31]=w):w=e[31];let E;return e[32]!==h||e[33]!==x||e[34]!==w?(E=S.jsxs("div",{className:h,children:[x,w]}),e[32]=h,e[33]=x,e[34]=w,e[35]=E):E=e[35],E}function fe(o){return{type:"file",file:o,name:o.name,filePath:o.name,folderPath:"/"}}async function M(o,e=""){const l=[];for await(const t of o.values()){const n=`${e.endsWith("/")?e:e+"/"}${t.name}`,a={type:t.kind==="file"?"file":"folder",name:t.name,filePath:n,folderPath:e};if(t.kind==="file"){const c=await t.getFile();a.file=c,a.size=c.size}else t.kind==="directory"&&(a.children=await M(t,n));l.push(a)}return l}function ue(o,e=!1){const l=[];function t(n){const{children:a,...c}=n;e?n.type==="file"&&l.push(c):l.push(c),n.children&&n.children.length>0&&n.children.forEach(t)}return o.forEach(t),l}export{ye as F};
