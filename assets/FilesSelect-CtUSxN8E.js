import{b as B,j}from"./@uiw/react-codemirror-dimZJgSu.js";import{c as U,b as H,Q as M,l as O,B as Q,ac as W,r as q}from"./index-CwDalt6B.js";import{D as G}from"./index-C1Uc0xMy.js";function ee(n){const e=U.c(46),{targetType:r,onSelect:t,isIgnoreFolder:a,isUpload:i,className:c,children:T}=n,$=r===void 0?"tree":r,z=a===void 0?!1:a,s=i===void 0?!1:i,C=c===void 0?"":c,{t:l}=H(),_=B.useRef(null),{message:b}=M.useApp();let d;e[0]!==s||e[1]!==l?(d=s?l("components.FilesSelect.upload",{defaultValue:"ä¸Šä¼ æ–‡ä»¶"}):l("components.FilesSelect.select",{defaultValue:"é€‰æ‹©æ–‡ä»¶"}),e[0]=s,e[1]=l,e[2]=d):d=e[2];let u;e[3]!==d?(u={label:d,key:"upload-file"},e[3]=d,e[4]=u):u=e[4];let p;e[5]!==s||e[6]!==l?(p=s?l("components.FilesSelect.uploadFolder",{defaultValue:"ä¸Šä¼ æ–‡ä»¶å¤¹ï¼ˆå«æ ¹ç›®å½•ï¼‰"}):l("components.FilesSelect.selectFolder",{defaultValue:"é€‰æ‹©æ–‡ä»¶å¤¹ï¼ˆå«æ ¹ç›®å½•ï¼‰"}),e[5]=s,e[6]=l,e[7]=p):p=e[7];let m;e[8]!==p?(m={label:p,key:"upload-folder-include-root"},e[8]=p,e[9]=m):m=e[9];let h;e[10]!==s||e[11]!==l?(h=s?l("components.FilesSelect.uploadFolderExcludeRoot",{defaultValue:"ä¸Šä¼ æ–‡ä»¶å¤¹ï¼ˆä¸å«æ ¹ç›®å½•ï¼‰"}):l("components.FilesSelect.selectFolderExcludeRoot",{defaultValue:"é€‰æ‹©æ–‡ä»¶å¤¹ï¼ˆä¸å«æ ¹ç›®å½•ï¼‰"}),e[10]=s,e[11]=l,e[12]=h):h=e[12];let F;e[13]!==h?(F={label:h,key:"upload-folder-exclude-root"},e[13]=h,e[14]=F):F=e[14];let P;e[15]!==F||e[16]!==u||e[17]!==m?(P=[u,m,F],e[15]=F,e[16]=u,e[17]=m,e[18]=P):P=e[18];const A=P;let y;if(e[19]!==z||e[20]!==b||e[21]!==t||e[22]!==l||e[23]!==$){y=f=>{const o=f.key;o==="upload-folder-include-root"?I("upload-folder-include-root"):o==="upload-folder-exclude-root"?I("upload-folder-exclude-root"):_.current&&_.current.click()};async function I(f){if(!window.showDirectoryPicker){b.warning(l("components.FilesSelect.noSupport",{defaultValue:"å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ"}));return}let o;try{if(o=await window.showDirectoryPicker({mode:"read",id:f}),!o)return;let V;if(f==="upload-folder-include-root"?V=[{type:"folder",name:o.name,filePath:`/${o.name}`,folderPath:"/",children:await N(o,`/${o.name}`)}]:V=await N(o,"/"),$==="tree")t(V);else{const E=X(V,z);t(E)}}catch(V){const E=V;E instanceof Error&&E.message.includes("aborted")?b.warning(l("components.FilesSelect.chooseFolder",{defaultValue:"è¯·é€‰æ‹©æ–‡ä»¶å¤¹"})):console.log("ðŸš€ ~ selectDirectoryStoreFn ~ error:",E)}}e[19]=z,e[20]=b,e[21]=t,e[22]=l,e[23]=$,e[24]=y}else y=e[24];let R;e[25]!==t?(R=I=>{const f=I.target.files;if(f){const o=Array.from(f).map(J);o.length>0&&t(o)}},e[25]=t,e[26]=R):R=e[26];const L=R;let x;e[27]!==C?(x=O("files-select inline-flex",C),e[27]=C,e[28]=x):x=e[28];let S;e[29]!==A||e[30]!==y?(S={items:A,onClick:y},e[29]=A,e[30]=y,e[31]=S):S=e[31];let g;e[32]!==T||e[33]!==s||e[34]!==l?(g=T||j.jsx(Q,{children:j.jsxs(W,{children:[s?l("components.FilesSelect.uploadTitle",{defaultValue:"ä¸Šä¼ æ–‡ä»¶/æ–‡ä»¶å¤¹"}):l("components.FilesSelect.selectTitle",{defaultValue:"é€‰æ‹©æ–‡ä»¶/æ–‡ä»¶å¤¹"}),j.jsx(q,{})]})}),e[32]=T,e[33]=s,e[34]=l,e[35]=g):g=e[35];let w;e[36]!==S||e[37]!==g?(w=j.jsx(G,{menu:S,children:g}),e[36]=S,e[37]=g,e[38]=w):w=e[38];let v;e[39]===Symbol.for("react.memo_cache_sentinel")?(v={display:"none"},e[39]=v):v=e[39];let k;e[40]!==L?(k=j.jsx("input",{ref:_,type:"file",multiple:!0,style:v,onChange:L}),e[40]=L,e[41]=k):k=e[41];let D;return e[42]!==x||e[43]!==w||e[44]!==k?(D=j.jsxs("div",{className:x,children:[w,k]}),e[42]=x,e[43]=w,e[44]=k,e[45]=D):D=e[45],D}function J(n){return{type:"file",file:n,name:n.name,size:n.size,filePath:`/${n.name}`,folderPath:"/"}}async function N(n,e=""){const r=[];for await(const t of n.values()){const a=`${e.endsWith("/")?e:e+"/"}${t.name}`,i={type:t.kind==="file"?"file":"folder",name:t.name,filePath:a,folderPath:e};if(t.kind==="file"){const c=await t.getFile();i.file=c,i.size=c.size}else t.kind==="directory"&&(i.children=await N(t,a));r.push(i)}return r}function X(n,e=!1){const r=[];function t(a){const{children:i,...c}=a;e?a.type==="file"&&r.push(c):r.push(c),i&&i.length>0&&i.forEach(t)}return n.forEach(t),r}export{ee as F};
