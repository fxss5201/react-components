import{b as je,j as Z}from"./@uiw/react-codemirror-dimZJgSu.js";import{c as Tt,F as De,I as Ke,B as Lt}from"./index-CwDalt6B.js";import{M as Ut}from"./MDXRender--j0cKFwg.js";import{P as Mt}from"./Playground-XZt4ylVh.js";import{F as bt}from"./FilesDropSelect-Byb8B8Lb.js";import{J as Ct}from"./JsonView-DtypalN_.js";import{G as Bt,U as A,g as Zt,O as Je,a as At,Z as Vt,M as k,b as J,c as we,d as Yt,P as be,D as Ce,F as ke,e as ze,f as ve,h as qe,i as Be,j as kt,k as zt,l as vt,m as Le,n as Xt,o as ut,E as wt,p as Gt,q as Ht,r as jt,H as Ue,s as Kt,t as Jt,u as qt,v as $t,w as Qt,x as Wt,y as ea,z as ta,A as aa,B as ia,C as ra,I as $e,J as Xe,K as Qe,L as We,N as et,Q as sa,V as na,R as la,S as oa,T as fa,W as Ea,X as ca,Y as It,_ as St,$ as da,a0 as _a,a1 as ma,a2 as Ta,a3 as Aa,a4 as ua,a5 as wa,a6 as Ia,a7 as Sa,a8 as Ra,a9 as Fa,aa as Da,ab as Na,ac as pa,ad as Oa,ae as ya,af as xa,ag as ha,ah as Rt,ai as ga,aj as Pa,ak as La,al as Ua,am as Ft,an as Ma,ao as tt,ap as at,aq as ba,ar as it,as as rt,at as Ca,au as Ne,av as pe,aw as Ba,ax as Za,ay as Va,az as Ya,aA as ka,aB as za,aC as Dt,aD as va,aE as st,aF as Xa,aG as nt,aH as Ze,aI as Ga,aJ as Ha,aK as ja,aL as Ka,aM as lt,aN as Ja,aO as qa,aP as $a,aQ as Qa,aR as Wa,aS as ei,aT as ti,aU as ai,aV as ii,aW as ri,aX as si,aY as ni,aZ as li}from"./zip-fs-wasm-CLf83jnj.js";import{a as oi}from"./index-B3cNn7YV.js";import{u as Nt}from"./@mdx-js/react-BwGmxI0N.js";import"./react-syntax-highlighter-DW6ulm9l.js";import"./markdown-plugins-CqPL4kxN.js";import"./react-markdown-U0gPFawi.js";import"./DropElement-C0NNM9yT.js";import"./index-BSg5Lc9Y.js";import"./isBrowser-BdZk1G-M.js";import"./FilesSelect-CtUSxN8E.js";import"./index-C1Uc0xMy.js";import"./JsonEditor-C8Qw5Tcq.js";import"./CodeEditor-DCLYA5gR.js";import"./JsonRender-CBqOC-Sc.js";import"./use-undo.m-DQTOi8z5.js";import"./index-C7j3i05K.js";const fi="File already exists",Ei="Zip file comment exceeds 64KB",ci="File entry comment exceeds 64KB",di="File entry name exceeds 64KB",ot="Version exceeds 65535",_i="The strength must equal 1, 2, or 3",mi="Extra field type exceeds 65535",Ti="Extra field data exceeds 64KB",Ge="Zip64 is not supported (make sure 'keepOrder' is set to 'true')",Ai="Undefined uncompressed size",ui="Zip file not empty",wi="Invalid uid (must be integer 0..2^32-1)",Ii="Invalid gid (must be integer 0..2^32-1)",Si="Invalid UNIX mode (must be integer 0..65535)",Ri="Invalid unixExtraFieldType (must be 'infozip' or 'unix')",Fi="Invalid msdosAttributesRaw (must be integer 0..255)",Di="Invalid msdosAttributes (must be an object with boolean flags)",ft=new Uint8Array([7,0,2,0,65,69,3,0,0]),pt="infozip",Ot="unix";let Ve=0;const Et=[];class Ni{constructor(a,i={}){a=new Bt(a);const t=a.availableSize!==A&&a.availableSize>0&&a.availableSize!==1/0&&a.maxSize!==A&&a.maxSize>0&&a.maxSize!==1/0;Object.assign(this,{writer:a,addSplitZipSignature:t,options:i,config:Zt(),files:new Map,filenames:new Set,offset:i[Je]===A?a.size||a.writable.size||0:i[Je],pendingEntriesSize:0,pendingAddFileCalls:new Set,bufferedWrites:0})}async prependZip(a){if(this.filenames.size)throw new Error(ui);a=new At(a);const i=new Vt(a.readable),t=await i.getEntries();await i.close(),await a.readable.pipeTo(this.writer.writable,{preventClose:!0,preventAbort:!0}),this.writer.size=this.offset=a.size,this.filenames=new Set(t.map(r=>r.filename)),this.files=new Map(t.map(r=>{const{version:s,compressionMethod:l,lastModDate:n,lastAccessDate:_,creationDate:E,rawFilename:T,bitFlag:d,encrypted:N,uncompressedSize:c,compressedSize:m,diskOffset:F,diskNumber:M,zip64:y}=r;let{rawExtraFieldZip64:o,rawExtraFieldAES:D,rawExtraFieldExtendedTimestamp:h,rawExtraFieldNTFS:B,rawExtraFieldUnix:V,rawExtraField:O}=r;const{level:I,languageEncodingFlag:P,dataDescriptor:L}=d;o=o||new Uint8Array,D=D||new Uint8Array,h=h||new Uint8Array,B=B||new Uint8Array,V=r.rawExtraFieldUnix||new Uint8Array,O=O||new Uint8Array;const Y=w(o,D,h,B,V,O),j=y&&c>J,U=y&&m>J,{headerArray:x,headerView:p}=yt({version:s,bitFlag:xt(I,P,L,N,l),compressionMethod:l,uncompressedSize:c,compressedSize:m,lastModDate:n,rawFilename:T,zip64CompressedSize:U,zip64UncompressedSize:j,extraFieldLength:Y});return Object.assign(r,{zip64UncompressedSize:j,zip64CompressedSize:U,zip64Offset:y&&this.offset-F>J,zip64DiskNumberStart:y&&M>k,rawExtraFieldZip64:o,rawExtraFieldAES:D,rawExtraFieldExtendedTimestamp:h,rawExtraFieldNTFS:B,rawExtraFieldUnix:V,rawExtraField:O,extendedTimestamp:h.length>0||B.length>0,extraFieldExtendedTimestampFlag:1+(_?2:0)+(E?4:0),headerArray:x,headerView:p}),[r.filename,r]}))}async add(a="",i,t={}){const r=this,{pendingAddFileCalls:s,config:l}=r;Ve<l.maxWorkers?Ve++:await new Promise(_=>Et.push(_));let n;try{if(a=a.trim(),r.filenames.has(a))throw new Error(fi);return r.filenames.add(a),n=pi(r,a,i,t),s.add(n),await n}catch(_){throw r.filenames.delete(a),_}finally{s.delete(n);const _=Et.shift();_?_():Ve--}}remove(a){const{filenames:i,files:t}=this;if(typeof a=="string"&&(a=t.get(a)),a&&a.filename!==A){const{filename:r}=a;if(i.has(r)&&t.has(r))return i.delete(r),t.delete(r),!0}return!1}async close(a=new Uint8Array,i={}){const t=this,{pendingAddFileCalls:r,writer:s}=this,{writable:l}=s;for(;r.size;)await Promise.allSettled(Array.from(r));return await Mi(t,a,i),u(t,i,jt)||await l.getWriter().close(),s.getData?s.getData():l}}async function pi(e,a,i,t){a=a.trim();let r=u(e,t,ta),s=u(e,t,ea,r?20:768);const l=u(e,t,Xa),n=u(e,t,Kt),_=u(e,t,Jt);let E=u(e,t,qt);const T=u(e,t,$t);let d=u(e,t,aa),N=u(e,t,ia),c=u(e,t,ra);if(n!==A&&(n<0||n>J))throw new Error(wi);if(_!==A&&(_<0||_>J))throw new Error(Ii);if(E!==A&&(E<0||E>k))throw new Error(Si);if(T!==A&&T!==pt&&T!==Ot)throw new Error(Ri);let m=u(e,t,Qt),F=u(e,t,Wt);const M=n!==A||_!==A||E!==A||T,y=m!==A||F!==A;if(M?(r=!1,s=s&k|768):y&&(r=!0,s=s&we),m!==A&&(m<0||m>we))throw new Error(Fi);if(F&&typeof F!==Yt)throw new Error(Di);if(s>k)throw new Error(ot);let o=u(e,t,Ta,0);!t[be]&&a.endsWith(Ce)&&(t[be]=!0);const D=u(e,t,be);D?(a.endsWith(Ce)||(a+=Ce),o===0&&(o=Xe,r||(o|=(qe|nt|Ze)<<16))):!r&&o===0&&(l?o=(nt|Ze)<<16:o=Ze<<16);let h;r||(h=o>>16&k,E=E===A?h:E&k,d?E|=ke:d=!!(E&ke),N?E|=ze:N=!!(E&ze),c?E|=ve:c=!!(E&ve),D&&(E|=qe),o=(E&k)<<16|o&we),{msdosAttributesRaw:m,msdosAttributes:F}=gi(m,F),y&&(o=o&J|m&we);const B=u(e,t,sa,Be);let V=B(a);if(V===A&&(V=Be(a)),w(V)>k)throw new Error(di);const O=t[kt]||"";let I=B(O);if(I===A&&(I=Be(O)),w(I)>k)throw new Error(ci);const P=u(e,t,la,na);if(P>k)throw new Error(ot);const L=u(e,t,ya,new Date),Y=u(e,t,Oa),j=u(e,t,pa),U=u(e,t,Aa,0),x=u(e,t,oa);let p,z;x||(p=u(e,t,Ga),z=u(e,t,Ha));const v=u(e,t,ca,3),W=u(e,t,Ea),le=u(e,t,Fa,!0),oe=u(e,t,da,!0),fe=u(e,t,Da),me=u(e,t,Ra),X=u(e,t,wa,!1),q=u(e,t,ua),re=u(e,t,Sa,!0),b=u(e,t,_a);let G=u(e,t,Na),C=u(e,t,fa),f=u(e,t,Ia);me&&f===A&&(f=!1),(f===A||W)&&(f=!0),G!==A&&G!=6&&(C=!1),!C&&e.config.CompressionStream===A&&e.config.CompressionStreamZlib===A&&(G=0);let Q=u(e,t,It);if(!W&&(p!==A||z!==A)&&!(v>=1&&v<=3))throw new Error(_i);let Ee=new Uint8Array;const se=t[zt];if(se){let Se=0,de=0;se.forEach(ie=>Se+=4+w(ie)),Ee=new Uint8Array(Se),se.forEach((ie,Pe)=>{if(Pe>k)throw new Error(mi);if(w(ie)>k)throw new Error(Ti);g(Ee,new Uint16Array([Pe]),de),g(Ee,new Uint16Array([w(ie)]),de+2),g(Ee,ie,de+4),de+=4+w(ie)})}let ee=0,te=0,$=0;if(x&&($=t[vt],$===A))throw new Error(Ai);const ce=Q===!0;i&&(i=new At(i),await Le(i),x?(t.uncompressedSize=$,ee=_t($)):i.size===A?(f=!0,(Q||Q===A)&&(Q=!0,$=ee=J+1)):(t.uncompressedSize=$=i.size,ee=_t($)));const{diskOffset:ne,diskNumber:ae,maxSize:Te}=e.writer,Fe=ce||$>J,Oe=ce||ee>J,ye=ce||e.offset+e.pendingEntriesSize-ne>J,xe=u(e,t,St,!0)&&ce||ae+Math.ceil(e.pendingEntriesSize/Te)>k;if(ye||Fe||Oe||xe){if(Q===!1||!oe)throw new Error(Ge);Q=!0}Q=Q||!1;const Me=u(e,t,ma);t=Object.assign({},t,{rawFilename:V,rawComment:I,version:P,versionMadeBy:s,lastModDate:L,lastAccessDate:Y,creationDate:j,rawExtraField:Ee,zip64:Q,zip64UncompressedSize:Fe,zip64CompressedSize:Oe,zip64Offset:ye,zip64DiskNumberStart:xe,password:p,rawPassword:z,level:G,useWebWorkers:fe,encryptionStrength:v,extendedTimestamp:le,zipCrypto:W,bufferedWrite:me,keepOrder:oe,useUnicodeFileNames:re,dataDescriptor:f,dataDescriptorSignature:X,signal:q,msDosCompatible:r,internalFileAttribute:U,internalFileAttributes:U,externalFileAttribute:o,externalFileAttributes:o,useCompressionStream:C,passThrough:x,encrypted:!!(p&&w(p)||z&&w(z))||x&&Me,signature:t[Xt],compressionMethod:b,uncompressedSize:$,offset:e.offset-ne,diskNumberStart:ae,uid:n,gid:_,setuid:d,setgid:N,sticky:c,unixMode:E,msdosAttributesRaw:m,msdosAttributes:F,unixExternalUpper:h});const he=xi(t),ge=Pi(t),Ae=w(he.localHeaderArray,ge.dataDescriptorArray);te=Ae+ee,e.options[ut]&&(te+=te+64),e.pendingEntriesSize+=te;let Ie;try{Ie=await Oi(e,a,i,{headerInfo:he,dataDescriptorInfo:ge,metadataSize:Ae},t)}finally{e.pendingEntriesSize-=te}return Object.assign(Ie,{name:a,comment:O,extraField:se}),new wt(Ie)}async function Oi(e,a,i,t,r){const{files:s,writer:l}=e,{keepOrder:n,dataDescriptor:_,signal:E}=r,{headerInfo:T}=t,d=e.options[ut],N=Array.from(s.values()).pop();let c={},m,F,M,y,o,D,h;s.set(a,c);try{let I;n&&(I=N&&N.lock,B()),(r.bufferedWrite||e.writerLocked||e.bufferedWrites&&n||!_)&&!d?(D=new TransformStream,D.size=0,m=!0,e.bufferedWrites++,await Le(l)):(D=l,await V()),await Le(D);const{writable:P,diskOffset:L}=l;if(e.addSplitZipSignature){delete e.addSplitZipSignature;const p=new Uint8Array(4),z=K(p);S(z,0,Za),await _e(l,p),e.offset+=4}d&&hi(t,e.offset-L);const{localHeaderView:Y,localHeaderArray:j}=T;m||(await I,await O(P));const{diskNumber:U}=l;o=!0,c.diskNumberStart=U,m?h=new Response(D.readable).blob():await _e(D,j),c=await yi(i,D,c,t,e.config,r);const{zip64:x}=c;if(o=!1,s.set(a,c),c.filename=a,m){const[p]=await Promise.all([h,D.writable.getWriter().close(),I]);await V(),y=!0,c.diskNumberStart=l.diskNumber,c.offset=e.offset-l.diskOffset,x&&dt(c),Ui(c,Y,r),await O(P),await _e(l,j),await p.stream().pipeTo(P,{preventClose:!0,preventAbort:!0,signal:E}),l.size+=D.size,y=!1}else c.offset=e.offset-L,x&&dt(c);if(c.offset>J&&!x)throw new Error(Ge);return e.offset+=c.size,c}catch(I){if(m&&y||!m&&o){if(e.hasCorruptedEntries=!0,I)try{I.corruptedEntry=!0}catch{}m?e.offset+=D.size:e.offset=D.size}throw s.delete(a),I}finally{m&&e.bufferedWrites--,M&&M(),F&&F()}function B(){c.lock=new Promise(I=>M=I)}async function V(){e.writerLocked=!0;const{lockWriter:I}=e;e.lockWriter=new Promise(P=>F=()=>{e.writerLocked=!1,P()}),await I}async function O(I){w(T.localHeaderArray)>l.availableSize&&(l.availableSize=0,await _e(I,new Uint8Array))}}async function yi(e,a,{diskNumberStart:i,lock:t},r,s,l){const{headerInfo:n,dataDescriptorInfo:_,metadataSize:E}=r,{headerArray:T,headerView:d,lastModDate:N,rawLastModDate:c,encrypted:m,compressed:F,version:M,compressionMethod:y,rawExtraFieldZip64:o,localExtraFieldZip64Length:D,rawExtraFieldExtendedTimestamp:h,extraFieldExtendedTimestampFlag:B,rawExtraFieldNTFS:V,rawExtraFieldUnix:O,rawExtraFieldAES:I}=n,{dataDescriptorArray:P}=_,{rawFilename:L,lastAccessDate:Y,creationDate:j,password:U,rawPassword:x,level:p,zip64:z,zip64UncompressedSize:v,zip64CompressedSize:W,zip64Offset:le,zip64DiskNumberStart:oe,zipCrypto:fe,dataDescriptor:me,directory:X,executable:q,versionMadeBy:re,rawComment:b,rawExtraField:G,useWebWorkers:C,onstart:f,onprogress:Q,onend:Ee,signal:se,encryptionStrength:ee,extendedTimestamp:te,msDosCompatible:$,internalFileAttributes:ce,externalFileAttributes:ne,uid:ae,gid:Te,unixMode:Fe,setuid:Oe,setgid:ye,sticky:He,unixExternalUpper:xe,msdosAttributesRaw:Me,msdosAttributes:he,useCompressionStream:ge,passThrough:Ae}=l,Ie={lock:t,versionMadeBy:re,zip64:z,directory:!!X,executable:!!q,filenameUTF8:!0,rawFilename:L,commentUTF8:!0,rawComment:b,rawExtraFieldZip64:o,localExtraFieldZip64Length:D,rawExtraFieldExtendedTimestamp:h,rawExtraFieldNTFS:V,rawExtraFieldUnix:O,rawExtraFieldAES:I,rawExtraField:G,extendedTimestamp:te,msDosCompatible:$,internalFileAttributes:ce,externalFileAttributes:ne,diskNumberStart:i,uid:ae,gid:Te,unixMode:Fe,setuid:Oe,setgid:ye,sticky:He,unixExternalUpper:xe,msdosAttributesRaw:Me,msdosAttributes:he};let{signature:Se,uncompressedSize:de}=l,ie=0;Ae||(de=0);const{writable:Pe}=a;if(e){e.chunkSize=Ya(s);const ht=e.readable,gt=e.size,Pt={options:{codecType:za,level:p,rawPassword:x,password:U,encryptionStrength:ee,zipCrypto:m&&fe,passwordVerification:m&&fe&&c>>8&we,signed:!Ae,compressed:F&&!Ae,encrypted:m&&!Ae,useWebWorkers:C,useCompressionStream:ge,transferStreams:!1},config:s,streamOptions:{signal:se,size:gt,onstart:f,onprogress:Q,onend:Ee}};try{const ue=await ka({readable:ht,writable:Pe},Pt);ie=ue.outputSize,a.size+=ie,Ae||(de=ue.inputSize,Se=ue.signature)}catch(ue){throw ue.outputSize!==A&&(a.size+=ue.outputSize),ue}}return Li({signature:Se,compressedSize:ie,uncompressedSize:de,headerInfo:n,dataDescriptorInfo:_},l),me&&await _e(a,P),Object.assign(Ie,{uncompressedSize:de,compressedSize:ie,lastModDate:N,rawLastModDate:c,creationDate:j,lastAccessDate:Y,encrypted:m,zipCrypto:fe,size:E+ie,compressionMethod:y,version:M,headerArray:T,headerView:d,signature:Se,extraFieldExtendedTimestampFlag:B,zip64UncompressedSize:v,zip64CompressedSize:W,zip64Offset:le,zip64DiskNumberStart:oe}),Ie}function xi(e){const{rawFilename:a,lastModDate:i,lastAccessDate:t,creationDate:r,level:s,zip64:l,zipCrypto:n,useUnicodeFileNames:_,dataDescriptor:E,directory:T,rawExtraField:d,encryptionStrength:N,extendedTimestamp:c,passThrough:m,encrypted:F,zip64UncompressedSize:M,zip64CompressedSize:y,zip64Offset:o,zip64DiskNumberStart:D,uncompressedSize:h,offset:B,diskNumberStart:V}=e;let{version:O,compressionMethod:I}=e;const P=!T&&(s>0||s===A&&I!==0);let L;const Y=m||!P,j=l&&(e.bufferedWrite||!M&&!y||Y);if(l){let b=4;M&&(b+=8),y&&(b+=8),o&&(b+=8),D&&(b+=4),L=new Uint8Array(b);const G=K(L);if(R(G,0,xa),R(G,2,w(L)-4),j){const C=K(L);let f=4;M&&(H(C,f,BigInt(h)),f+=8),y&&Y&&(H(C,f,BigInt(h)),f+=8),o&&(H(C,f,BigInt(B)),f+=8),D&&(S(C,f,V),f+=4)}}else L=new Uint8Array;let U;if(F&&!n){U=new Uint8Array(w(ft)+2);const b=K(U);R(b,0,ha),g(U,ft,2),Re(b,8,N)}else U=new Uint8Array;let x,p,z;if(c){p=new Uint8Array(9+(t?4:0)+(r?4:0));const b=K(p);R(b,0,Rt),R(b,2,w(p)-4),z=1+(t?2:0)+(r?4:0),Re(b,4,z);let G=5;S(b,G,Math.floor(i.getTime()/1e3)),G+=4,t&&(S(b,G,Math.floor(t.getTime()/1e3)),G+=4),r&&S(b,G,Math.floor(r.getTime()/1e3));try{x=new Uint8Array(36);const C=K(x),f=Ye(i);R(C,0,ga),R(C,2,32),R(C,8,Pa),R(C,10,24),H(C,12,f),H(C,20,Ye(t)||f),H(C,28,Ye(r)||f)}catch{x=new Uint8Array}}else x=p=new Uint8Array;let v;try{const{uid:b,gid:G,unixMode:C,setuid:f,setgid:Q,sticky:Ee,unixExtraFieldType:se}=e;if(se&&(b!==A||G!==A||C!==A)){const ee=ct(b),te=ct(G);let $=new Uint8Array;if(se==Ot&&C!==A){let Te=C&k;f&&(Te|=ke),Q&&(Te|=ze),Ee&&(Te|=ve),$=new Uint8Array(2),new DataView($.buffer).setUint16(0,Te,!0)}const ce=3+ee.length+te.length+$.length;v=new Uint8Array(4+ce);const ne=K(v);R(ne,0,se==pt?La:Ua),R(ne,2,ce),Re(ne,4,1),Re(ne,5,ee.length);let ae=6;g(v,ee,ae),ae+=ee.length,Re(ne,ae,te.length),ae++,g(v,te,ae),ae+=te.length,g(v,$,ae)}else v=new Uint8Array}catch{v=new Uint8Array}I===A&&(I=P?Ft:Ma),l&&(O=O>tt?O:tt),F&&!n&&(O=O>at?O:at,U[9]=I,I=ba);const W=j?w(L):0,le=W+w(U,p,x,v,d),{headerArray:oe,headerView:fe,rawLastModDate:me}=yt({version:O,bitFlag:xt(s,_,E,F,I),compressionMethod:I,uncompressedSize:h,lastModDate:i<it?it:i>rt?rt:i,rawFilename:a,zip64CompressedSize:y,zip64UncompressedSize:M,extraFieldLength:le});let X=Ue;const q=new Uint8Array(X+w(a)+le),re=K(q);return S(re,0,Ca),g(q,oe,4),g(q,a,X),X+=w(a),j&&g(q,L,X),X+=W,g(q,U,X),X+=w(U),g(q,p,X),X+=w(p),g(q,x,X),X+=w(x),g(q,v,X),X+=w(v),g(q,d,X),E&&(S(re,Ne+4,0),S(re,pe+4,0)),{localHeaderArray:q,localHeaderView:re,headerArray:oe,headerView:fe,lastModDate:i,rawLastModDate:me,encrypted:F,compressed:P,version:O,compressionMethod:I,extraFieldExtendedTimestampFlag:z,rawExtraFieldZip64:L,localExtraFieldZip64Length:W,rawExtraFieldExtendedTimestamp:p,rawExtraFieldNTFS:x,rawExtraFieldUnix:v,rawExtraFieldAES:U,extraFieldLength:le}}function hi(e,a){const{headerInfo:i}=e;let{localHeaderArray:t,extraFieldLength:r}=i,s=K(t),l=64-(a+w(t))%64;l<4&&(l+=64);const n=new Uint8Array(l),_=K(n);R(_,0,Va),R(_,2,l-2);const E=t;i.localHeaderArray=t=new Uint8Array(w(E)+l),g(t,E),g(t,n,w(E)),s=K(t),R(s,28,r+l),e.metadataSize+=l}function ct(e){if(e===A)return new Uint8Array;{const a=new Uint8Array(4);K(a).setUint32(0,e,!0);let t=4;for(;t>1&&a[t-1]===0;)t--;return a.subarray(0,t)}}function gi(e,a){if(e!==A)e=e&we;else if(a!==A){const{readOnly:i,hidden:t,system:r,directory:s,archive:l}=a;let n=0;i&&(n|=et),t&&(n|=We),r&&(n|=Qe),s&&(n|=Xe),l&&(n|=$e),e=n&we}return a===A&&(a={readOnly:!!(e&et),hidden:!!(e&We),system:!!(e&Qe),directory:!!(e&Xe),archive:!!(e&$e)}),{msdosAttributesRaw:e,msdosAttributes:a}}function Pi({zip64:e,dataDescriptor:a,dataDescriptorSignature:i}){let t=new Uint8Array,r,s=0,l=e?ja:Ka;return i&&(l+=lt),a&&(t=new Uint8Array(l),r=K(t),i&&(s=lt,S(r,0,Ba))),{dataDescriptorArray:t,dataDescriptorView:r,dataDescriptorOffset:s}}function Li({signature:e,compressedSize:a,uncompressedSize:i,headerInfo:t,dataDescriptorInfo:r},{zip64:s,zipCrypto:l,dataDescriptor:n}){const{headerView:_,encrypted:E}=t,{dataDescriptorView:T,dataDescriptorOffset:d}=r;(!E||l)&&e!==A&&(S(_,Dt,e),n&&S(T,d,e)),s?n&&(H(T,d+4,BigInt(a)),H(T,d+12,BigInt(i))):(S(_,Ne,a),S(_,pe,i),n&&(S(T,d+4,a),S(T,d+8,i)))}function Ui({rawFilename:e,encrypted:a,zip64:i,localExtraFieldZip64Length:t,signature:r,compressedSize:s,uncompressedSize:l,offset:n,diskNumberStart:_,zip64UncompressedSize:E,zip64CompressedSize:T,zip64Offset:d,zip64DiskNumberStart:N},c,{dataDescriptor:m}){if(m||(a||S(c,Dt+4,r),i||(S(c,Ne+4,s),S(c,pe+4,l))),i&&t){let F=Ue+w(e)+4;E&&(H(c,F,BigInt(l)),F+=8),T&&(H(c,F,BigInt(s)),F+=8),d&&(H(c,F,BigInt(n)),F+=8),N&&S(c,F,_)}}function dt({compressedSize:e,uncompressedSize:a,offset:i,diskNumberStart:t,zip64UncompressedSize:r,zip64CompressedSize:s,zip64Offset:l,zip64DiskNumberStart:n,rawExtraFieldZip64:_}){const E=K(_);let T=4;r&&(H(E,T,BigInt(a)),T+=8),s&&(H(E,T,BigInt(e)),T+=8),l&&(H(E,T,BigInt(i)),T+=8),n&&S(E,T,t)}async function Mi(e,a,i){const{files:t,writer:r}=e,{diskOffset:s}=r;let{diskNumber:l}=r,n=0,_=0,E=e.offset-s,T=t.size;for(const[,h]of t){const{rawFilename:B,rawExtraFieldZip64:V,rawExtraFieldAES:O,rawComment:I,rawExtraFieldNTFS:P,rawExtraFieldUnix:L,rawExtraField:Y,extendedTimestamp:j,extraFieldExtendedTimestampFlag:U,lastModDate:x}=h;let p;if(j){p=new Uint8Array(9);const z=K(p);R(z,0,Rt),R(z,2,5),Re(z,4,U),S(z,5,Math.floor(x.getTime()/1e3))}else p=new Uint8Array;h.rawExtraFieldExtendedTimestamp=p,_+=46+w(B,I,V,O,P,L,p,Y)}const d=new Uint8Array(_),N=K(d);await Le(r);let c=0;for(const[h,B]of Array.from(t.values()).entries()){const{offset:V,rawFilename:O,rawExtraFieldZip64:I,rawExtraFieldAES:P,rawExtraFieldExtendedTimestamp:L,rawExtraFieldNTFS:Y,rawExtraFieldUnix:j,rawExtraField:U,rawComment:x,versionMadeBy:p,headerArray:z,headerView:v,zip64:W,zip64UncompressedSize:le,zip64CompressedSize:oe,zip64DiskNumberStart:fe,zip64Offset:me,internalFileAttributes:X,externalFileAttributes:q,diskNumberStart:re,uncompressedSize:b,compressedSize:G}=B,C=w(I,P,L,Y,j,U);S(N,n,Ja),R(N,n+4,p),le||S(v,pe,b),oe||S(v,Ne,G),g(d,z,n+6);let f=n+Ue;if(R(N,f,C),f+=2,R(N,f,w(x)),f+=2,R(N,f,W&&fe?k:re),f+=2,R(N,f,X),f+=2,q&&S(N,f,q),f+=4,S(N,f,W&&me?J:V),f+=4,g(d,O,f),f+=w(O),g(d,I,f),f+=w(I),g(d,P,f),f+=w(P),g(d,L,f),f+=w(L),g(d,Y,f),f+=w(Y),g(d,j,f),f+=w(j),g(d,U,f),f+=w(U),g(d,x,f),f+=w(x),n-c>r.availableSize&&(r.availableSize=0,await _e(r,d.slice(c,n)),c=n),n=f,i.onprogress)try{await i.onprogress(h+1,t.size,new wt(B))}catch{}}await _e(r,c?d.slice(c):d);let m=r.diskNumber;const{availableSize:F}=r;F<st&&m++;let M=u(e,i,It);if(E>J||_>J||T>k||m>k){if(M===!1)throw new Error(Ge);M=!0}const y=new Uint8Array(M?va:st),o=K(y);n=0,M&&(S(o,0,qa),H(o,4,BigInt(44)),R(o,12,45),R(o,14,45),S(o,16,m),S(o,20,l),H(o,24,BigInt(T)),H(o,32,BigInt(T)),H(o,40,BigInt(_)),H(o,48,BigInt(E)),S(o,56,$a),H(o,64,BigInt(E)+BigInt(_)),S(o,72,m+1),u(e,i,St,!0)&&(m=k,l=k),T=k,E=J,_=J,n+=Gt+Ht),S(o,n,Qa),R(o,n+4,m),R(o,n+6,l),R(o,n+8,T),R(o,n+10,T),S(o,n+12,_),S(o,n+16,E);const D=w(a);if(D)if(D<=k)R(o,n+20,D);else throw new Error(Ei);await _e(r,y),D&&await _e(r,a)}async function _e(e,a){const{writable:i}=e,t=i.getWriter();try{await t.ready,e.size+=w(a),await t.write(a)}finally{t.releaseLock()}}function Ye(e){if(e)return(BigInt(e.getTime())+BigInt(116444736e5))*BigInt(1e4)}function u(e,a,i,t){const r=a[i]===A?e.options[i]:a[i];return r===A?t:r}function _t(e){return e+5*(Math.floor(e/16383)+1)}function Re(e,a,i){e.setUint8(a,i)}function R(e,a,i){e.setUint16(a,i,!0)}function S(e,a,i){e.setUint32(a,i,!0)}function H(e,a,i){e.setBigUint64(a,i,!0)}function g(e,a,i){e.set(a,i)}function K(e){return new DataView(e.buffer)}function w(...e){let a=0;return e.forEach(i=>i&&(a+=i.length)),a}function yt({version:e,bitFlag:a,compressionMethod:i,uncompressedSize:t,compressedSize:r,lastModDate:s,rawFilename:l,zip64CompressedSize:n,zip64UncompressedSize:_,extraFieldLength:E}){const T=new Uint8Array(Ue-4),d=K(T);R(d,0,e),R(d,2,a),R(d,4,i);const N=new Uint32Array(1),c=K(N);R(c,0,(s.getHours()<<6|s.getMinutes())<<5|s.getSeconds()/2),R(c,2,(s.getFullYear()-1980<<4|s.getMonth()+1)<<5|s.getDate());const m=N[0];return S(d,6,m),(n||r!==A)&&S(d,Ne,n?J:r),(_||t!==A)&&S(d,pe,_?J:t),R(d,22,w(l)),R(d,24,E),{headerArray:T,headerView:d,rawLastModDate:m}}function xt(e,a,i,t,r){let s=0;return a&&(s=s|Wa),i&&(s=s|ei),(r==Ft||r==ti)&&(e>=0&&e<=3&&(s=s|ai),e>3&&e<=5&&(s=s|ii),e==9&&(s=s|ri)),t&&(s=s|si),s}function bi(){const e=Tt.c(22),[a]=De.useForm();let i;e[0]===Symbol.for("react.memo_cache_sentinel")?(i=[],e[0]=i):i=e[0];const[t,r]=je.useState(i),[s,l]=je.useState(!1);let n;e[1]===Symbol.for("react.memo_cache_sentinel")?(n=function(B){r(B)},e[1]=n):n=e[1];const _=n;let E;e[2]!==t?(E=async function(B){const{fileName:V,password:O}=B,I=V+".zip";l(!0);const P=new Ni(new ni("application/zip"),{bufferedWrite:!0,password:O});for(const Y of t)await P.add(Y.filePath,new li(Y.type==="file"?Y.file:new Blob([])),{directory:Y.type==="folder"});const L=await P.close();oi(L,I),l(!1)},e[2]=t,e[3]=E):E=e[3];const T=E;let d;e[4]===Symbol.for("react.memo_cache_sentinel")?(d=Z.jsx(bt,{targetType:"list",onSelect:_,classNames:{dropElement:"h-30!"}}),e[4]=d):d=e[4];let N;e[5]!==t?(N=Z.jsx(Ct,{className:"mt-3!",jsonClassName:"max-h-50 overflow-auto",children:t}),e[5]=t,e[6]=N):N=e[6];let c;e[7]===Symbol.for("react.memo_cache_sentinel")?(c={fileName:"zipFiles"},e[7]=c):c=e[7];let m;e[8]===Symbol.for("react.memo_cache_sentinel")?(m=[{required:!0,message:"请输入文件名"}],e[8]=m):m=e[8];let F;e[9]===Symbol.for("react.memo_cache_sentinel")?(F=Z.jsx(De.Item,{label:"文件名",name:"fileName",rules:m,children:Z.jsx(Ke,{suffix:Z.jsx("span",{children:".zip"}),placeholder:"请输入文件名",allowClear:!0})}),e[9]=F):F=e[9];let M;e[10]===Symbol.for("react.memo_cache_sentinel")?(M=Z.jsx(De.Item,{label:"密码",name:"password",children:Z.jsx(Ke.Password,{placeholder:"请输入密码",allowClear:!0})}),e[10]=M):M=e[10];let y;e[11]!==a||e[12]!==t.length||e[13]!==s?(y=Z.jsx(De.Item,{shouldUpdate:!0,children:()=>Z.jsx(Lt,{htmlType:"submit",type:"primary",disabled:!t.length||a.getFieldValue("fileName")==="",loading:s,children:"压缩"})}),e[11]=a,e[12]=t.length,e[13]=s,e[14]=y):y=e[14];let o;e[15]!==a||e[16]!==T||e[17]!==y?(o=Z.jsx("div",{className:"mt-3",children:Z.jsxs(De,{form:a,name:"zip-writer-form",layout:"inline",initialValues:c,onFinish:T,children:[F,M,y]})}),e[15]=a,e[16]=T,e[17]=y,e[18]=o):o=e[18];let D;return e[19]!==o||e[20]!==N?(D=Z.jsxs(Z.Fragment,{children:[d,N,o]}),e[19]=o,e[20]=N,e[21]=D):D=e[21],D}const Ci=`import { useState } from 'react'
import FilesDropSelect from '@/components/FilesDropSelect'
import type { FileTreeItem } from '@/types/files'
import JsonView from '@/components/JsonView'
import { Button, Form, Input } from 'antd'
import { ZipWriter, BlobWriter, BlobReader } from '@zip.js/zip.js'
import { aDownloadBlob } from '@/utils'

function FilesZipWriter() {
  const [form] = Form.useForm()
  const [listData, setListData] = useState<FileTreeItem[]>([])
  const [loading, setLoading] = useState(false)

  function onSelect(fileList: FileTreeItem[]) {
    setListData(fileList)
  }

  async function onZip(values: { fileName: string, password?: string }) {
    const { fileName, password } = values
    const fileNameWithExt = fileName + '.zip'

    setLoading(true)
    const zipWriter = new ZipWriter(new BlobWriter('application/zip'), {
      bufferedWrite: true,
      password
    })
    for (const item of listData) {
      await zipWriter.add(item.filePath, new BlobReader(item.type === 'file' ? (item.file as Blob) : new Blob([])), { directory: item.type === 'folder' })
    }
    const zipBlob = await zipWriter.close()
    aDownloadBlob(zipBlob, fileNameWithExt)
    setLoading(false)
  }

  return (
    <>
      <FilesDropSelect targetType='list' onSelect={onSelect} classNames={{ dropElement: 'h-30!' }}></FilesDropSelect>
      <JsonView className='mt-3!' jsonClassName='max-h-50 overflow-auto'>{listData}</JsonView>
      <div className='mt-3'>
        <Form form={form} name='zip-writer-form' layout='inline' initialValues={{ fileName: 'zipFiles' }} onFinish={onZip}>
          <Form.Item
            label='文件名'
            name='fileName'
            rules={[{ required: true, message: '请输入文件名' }]}
          >
            <Input suffix={<span>.zip</span>} placeholder='请输入文件名' allowClear />
          </Form.Item>
          <Form.Item
            label='密码'
            name='password'
          >
            <Input.Password placeholder='请输入密码' allowClear />
          </Form.Item>
          <Form.Item shouldUpdate>
            {() => (
              <Button htmlType='submit' type='primary' disabled={!listData.length || form.getFieldValue('fileName') === ''} loading={loading}>压缩</Button>
            )}
          </Form.Item>
        </Form>
      </div>
    </>
  )
}

export default FilesZipWriter
`;function mt(e){const a={h1:"h1",...Nt(),...e.components};return Z.jsxs(Z.Fragment,{children:[Z.jsx(a.h1,{id:"fileszipwriter",children:"FilesZipWriter"}),`
`,Z.jsx(Mt,{code:Ci,title:"文件压缩",description:"选择文件列表，压缩为 zip 文件。",children:Z.jsx(bi,{})})]})}function Bi(e={}){const{wrapper:a}={...Nt(),...e.components};return a?Z.jsx(a,{...e,children:Z.jsx(mt,{...e})}):mt(e)}function nr(){const e=Tt.c(1);let a;return e[0]===Symbol.for("react.memo_cache_sentinel")?(a=Z.jsx("div",{className:"px-4 pb-4",children:Z.jsx(Ut,{children:Z.jsx(Bi,{})})}),e[0]=a):a=e[0],a}export{nr as default};
