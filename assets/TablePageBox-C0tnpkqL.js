import{b as a,j as n}from"./@uiw/react-codemirror-dimZJgSu.js";import{u as h,T as se}from"./TablePage-CQ77qt_-.js";import{e as re,b as le,Q as ce,F as j,ad as ie,B as k}from"./index-CwDalt6B.js";import{R as ue}from"./FormBlock-DxTtaAkV.js";var de={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"};function C(){return C=Object.assign?Object.assign.bind():function(s){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var r in l)Object.prototype.hasOwnProperty.call(l,r)&&(s[r]=l[r])}return s},C.apply(this,arguments)}const me=(s,o)=>a.createElement(re,C({},s,{ref:o,icon:de})),fe=a.forwardRef(me);function Fe(s){const{tablePageProps:o,isCustomOperation:l=!1,operationButtonDisplay:r="icon-text",operationButtonBefore:d,operationButtonAfter:m,ref:D,modalTitle:$,getFn:q,getOptions:O={manual:!1},getItemFn:I,addFn:H,putFn:Q,delFn:V,delteModalContentKey:K="name",ItemKey:v="id"}=s,M=a.useRef(null),{t:_}=le(),{modal:J}=ce.useApp(),[x,c]=a.useState(!1),[F,T]=a.useState(!1),[f]=j.useForm(),[p]=j.useForm(),[y,P]=a.useState(),[R,B]=a.useState(1),[i,G]=a.useState(10),[N,U]=a.useState(0);a.useEffect(()=>{x?f.setFieldsValue(y):f.resetFields()},[x,y,f]);const{data:W,error:z,loading:w,refresh:g,run:u}=h(q,{...O,retryCount:3,defaultParams:[{...O.defaultParams||{},page:R,pageSize:i}],onSuccess:e=>{const t=e?.data?.data;if(U(t.total),t.total>0&&R>1&&t.data.length===0){const L=Math.ceil(t.total/i);B(L),u({page:L,pageSize:i,...p.getFieldsValue()})}}}),{run:X,loading:Y}=h(H,{manual:!0,retryCount:3,onSuccess:()=>{g(),c(!1)}}),{run:Z,loading:ee}=h(Q,{manual:!0,retryCount:3,onSuccess:()=>{g(),c(!1)}}),{runAsync:te}=h(V,{manual:!0,retryCount:3}),oe=async e=>{await te(e),g()},b=async e=>{if(T(!0),I){const t=await I(e[v]);console.log(t),P({...e,...t?.data?.data})}else P(e);c(!0)},S=e=>{J.confirm({title:"删除提示",content:`确认删除 ${e[K]} 吗？`,closable:!0,onOk(){return oe(e[v])}})};if(a.useImperativeHandle(D,()=>({tableRef:M,formQuery:p,modalAddFn:t=>{T(!1),P(t),c(!0)},modalEditFn:b,modalDeleteFn:S,getRun:u}),[p,b,S,u]),z)return n.jsx(ie,{status:"error",title:z.message,extra:[n.jsx(k,{onClick:g,loading:w,children:_("components.TablePage.Request Again",{defaultValue:"重新请求"})},"Request Again")]});const ae=e=>{F?Z({...y,...e}):X(e)},ne=()=>{c(!1)},A=["icon","icon-text"].includes(r),E=["text","icon-text"].includes(r);return n.jsx(se,{sticky:{offsetHeader:158},...o,ref:M,loading:w,columns:[...o.columns||[],...l?[]:[{title:"操作",dataIndex:"operation",render:(e,t)=>n.jsxs(n.Fragment,{children:[d&&(typeof d=="function"?d(t):d),n.jsx(k,{color:"primary",variant:"text",size:"small",icon:A&&n.jsx(fe,{}),onClick:()=>{b(t)},children:E&&"编辑"}),n.jsx(k,{color:"danger",variant:"text",size:"small",icon:A&&n.jsx(ue,{}),onClick:()=>{S(t)},children:E&&"删除"}),m&&(typeof m=="function"?m(t):m)]})}]],dataSource:W?.data?.data?.data||[],bordered:!0,scroll:{scrollToFirstRowOnChange:!0},pagination:{current:R,pageSize:i,total:N,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`},onChange:e=>{B(e.current),G(e.pageSize),u({page:e.current,pageSize:e.pageSize})},formBlockProps:o.formBlockProps?.items?.length?{form:p,layout:"inline",onFinish:e=>{B(1),u({page:1,pageSize:i,...e})},...o.formBlockProps,items:o.formBlockProps?.items||[]}:void 0,actions:o.actions,formModalProps:o.formModalProps?.formBlockItems?.length?{title:`${F?"编辑":"添加"}${$}`,open:x,onCancel:ne,okButtonProps:{autoFocus:!0,htmlType:"submit"},confirmLoading:F?ee:Y,modalRender:e=>n.jsx(j,{form:f,onFinish:t=>ae(t),children:e}),forceRender:!0,formBlockItems:o.formModalProps?.formBlockItems||[]}:void 0})}export{fe as R,Fe as T};
