import React from 'react'
import Playground from '@/components/Playground'
import FilesListUpload from './FilesListUpload'
import FilesListUploadRaw from './FilesListUpload.tsx?raw'
import FilesListUploadTree from './FilesListUploadTree'
import FilesListUploadTreeRaw from './FilesListUploadTree.tsx?raw'
import FilesDrawerImg from '@/assets/FilesDrawer.png'

# FilesDrawer

`FilesDrawer` 组件是视图抽象层，提供样式和内部逻辑，可以用于文件/文件夹的上传、下载、压缩等，样式如下：

<img src={FilesDrawerImg} alt='FilesDrawer' />

**注意：当父文件夹失败的时候，内部的子文件/文件夹直接失败。**

## 目录

## API

### 参数 Props

``` ts
export type DrawerFileItemType = FileItemType & {
  icon?: React.ReactNode,
  percent?: number,
  percentStatus?: ProgressProps['status'],
}

export type DrawerResultFileTreeItemType = DrawerFileItemType & {
  children?: DrawerResultFileTreeItemType[]
}

export type FilesDrawerProps = {
  targetType?: TargetType,
  title?: string,
  open: boolean,
  setOpen: (open: boolean) => void,
  list: FileItemType[],
  doneFile: (fileItem: DrawerFileItemType) => Promise<void>,
  onSuccess?: (fileTrees: DrawerResultFileTreeItemType[]) => void,
}
```

| 属性 | 说明 | 类型 | 默认值 |
| --- | --- | --- | --- |
| `targetType` | 成功回调函数的参数类型 | `tree \| list` | `list` |
| `title` | 抽屉标题 | `string` | - |
| `open` | 是否打开抽屉 | `boolean` | `false` |
| `setOpen` | 打开/关闭抽屉的回调函数 | `(open: boolean) => void` | - |
| `list` | 文件/文件夹列表 | `FileItemType[]` | [] |
| `doneFile` | 处理文件/文件夹的回调函数 | `(fileItem: DrawerFileItemType) => Promise<void>` | - |
| `onSuccess` | 上传成功回调函数 | `(fileTrees: DrawerResultFileTreeItemType[]) => void` | - |

## 具体实现

### FilesUploadDrawer

`FilesUploadDrawer` 组件是 `FilesDrawer` 组件的具体实现，在内部实现了文件/文件夹的上传逻辑。

#### 参数 Props

``` ts
export type FilesUploadDrawerProps = Omit<FilesDrawerProps, 'title' | 'doneFile'> & {
  title?: string,
}
```

| 属性 | 说明 | 类型 | 默认值 |
| --- | --- | --- | --- |
| `targetType` | 成功回调函数的参数类型 | `tree \| list` | `list` |
| `title` | 抽屉标题 | `string` | - |
| `open` | 是否打开抽屉 | `boolean` | `false` |
| `setOpen` | 打开/关闭抽屉的回调函数 | `(open: boolean) => void` | - |
| `list` | 文件/文件夹列表 | `FileItemType[]` | [] |
| `onSuccess` | 上传成功回调函数 | `(fileTrees: DrawerResultFileTreeItemType[]) => void` | - |

#### 源代码

``` tsx
import FilesDrawer, { type FilesDrawerProps, type DrawerFileItemType } from '@/components/FilesDrawer'
import fileUploadMock from '@/common/fileUploadMock'

export type FilesUploadDrawerProps = Omit<FilesDrawerProps, 'doneFile'>

function FilesUploadDrawer({
  targetType = 'list',
  title = '上传文件/文件夹',
  open = false,
  setOpen,
  list = [],
  onSuccess
}: FilesUploadDrawerProps) {
  const doneFile = async (item: DrawerFileItemType) => {
    if (item.type === 'file') {
      await fileUploadMock()
    } else {
      await fileUploadMock()
    }
  }

  return (
    <FilesDrawer
      targetType={targetType}
      title={title}
      open={open}
      setOpen={setOpen}
      list={list}
      doneFile={doneFile}
      onSuccess={onSuccess}
    />
  )
}

export default FilesUploadDrawer
```

#### 上传文件/文件夹

<Playground code={FilesListUploadRaw} title='上传文件/文件夹' description='选择之后直接上传文件/文件夹，上传成功之后返回文件/文件夹的列表结构。'>
  <FilesListUpload />
</Playground>

#### 上传文件/文件夹（树结构）

<Playground code={FilesListUploadTreeRaw} title='上传文件/文件夹（树结构）' description='选择之后直接上传文件/文件夹，上传成功之后返回文件/文件夹的树结构。'>
  <FilesListUploadTree />
</Playground>
